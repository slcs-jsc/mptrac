<!DOCTYPE html>
<html>
  <head>
    <title>MPTRAC Web Runner</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  </head>
  
  <body style="font-family:monospace; background:#111; color:#ccc; padding:20px;">
    
    <!-- Header -->
    <div class="w3-container w3-padding-24" style="background: linear-gradient(90deg, #001530, #003366); color: white;">
      <div class="w3-row w3-center w3-padding-16 w3-content" style="max-width:1200px; margin:auto; display: flex; align-items: center; justify-content: center;">  
	<div style="display: flex; align-items: center;">
	  <img src="{{ url_for('static', filename='images/MPTRAC.svg') }}" alt="Logo" style="height:100px; margin-right:20px;">
	  <div style="text-align: left;">
            <h1 style="font-family: monospace; margin:0; font-size:32px;">Massive-Parallel Trajectory Calculations</h1>
            <h4 style="margin-top:6px; font-size:18px; color: #ddd;">Web Runner for Air Parcel Trajectory Calculations</h4>
	  </div>
	</div>
      </div>
    </div>
    
    <!-- Intro -->
    <div class="w3-container w3-padding-16 w3-center" style="background-color: #1a1a1a; color: white; transition: all 0.3s ease; margin-top: 10px;">
      <div class="w3-row w3-content" style="max-width:1200px; margin:auto;">
	<p style="font-size: 18px; color: #ddd; line-height: 1.6;">
	  <strong>Explore the MPTRAC Web Runner:</strong> Simulate and visualize air parcel trajectories to study atmospheric transport. 
	  Configure simulations with key parameters and download results for analysis and further studies.
	  This service is under active development. Please feel free to contact us with feedback or issues!
	</p>
	<div style="margin-top: 20px;">
	  <a href="https://slcs-jsc.github.io/mptrac/" class="w3-button w3-hover-shadow w3-padding-medium w3-round-large w3-hover-light-blue" style="background: #003366; color: white; font-size: 16px; border: none; transition: background-color 0.3s ease; margin-right: 20px;">ğŸ“˜ MPTRAC Documentation</a>
	  <a href="https://github.com/slcs-jsc/mptrac" class="w3-button w3-hover-shadow w3-padding-medium w3-round-large w3-hover-light-blue" style="background: #003366; color: white; font-size: 16px; border: none; transition: background-color 0.3s ease; margin-right: 20px;">ğŸ’» GitHub Repository</a>
	  <a href="mailto:l.hoffmann@fz-juelich.de?subject=Feedback%20on%20MPTRAC%20Web%20Runner" class="w3-button w3-hover-shadow w3-padding-medium w3-round-large w3-hover-light-blue" style="background: #003366; color: white; font-size: 16px; border: none; transition: background-color 0.3s ease;">ğŸ“¬ Contact Us</a>
	</div>
      </div>
    </div>
    
    <br>
    
    <h2 class="w3-center">Simulation Parameters</h2>
    
    <!-- Form -->
    <form method="POST" action="/run" onsubmit="showProgressModal()" class="w3-container w3-padding-16" style="width: 80%; margin: 0 auto;">
      
      <!-- Meteo Data Settings -->
      <button type="button" class="w3-button w3-block w3-dark-grey w3-left-align" style="margin-bottom: 12px;" onclick="toggleCollapsible('meteo-settings')">
	<i class="fa fa-caret-down"></i> Meteorological Data Settings
      </button>
      <div id="meteo-settings" class="w3-container w3-hide" style="background-color: #1a1a1a; color: white; padding: 16px; margin-bottom: 12px;">
	<p>Select the meteorological dataset for the trajectory calculations.</p>
	<div class="w3-row-padding">
	  <div class="w3-full">
	    <div class="w3-text-white">
	      
              <!-- Forecasts -->
              <div style="margin-bottom: 12px;">
		<h5 style="margin: 8px 0; color: #ccc;">Forecasts</h5>
		<label class="w3-block w3-padding-small">
		  <input type="radio" name="met_source" value="aifs_6h" required>
		  ECMWF AIFS (6-hourly | 0.25Â° Ã— 0.25Â° | 13 levels | recent 15-day forecasts)
		</label>
		<label class="w3-block w3-padding-small">
		  <input type="radio" name="met_source" value="ifs_6h" required>
		  ECMWF IFS (6-hourly | 0.25Â° Ã— 0.25Â° | 13 levels | recent 15-day forecasts)
		</label>
		<label class="w3-block w3-padding-small">
		  <input type="radio" name="met_source" value="gfs_3h" required>
		  NCEP GFS (3-hourly | 0.5Â° Ã— 0.5Â° | 41 levels | recent 10-day forecasts)
		</label>
              </div>
	      
              <!-- Reanalyses -->
              <div>
		<h5 style="margin: 8px 0; color: #ccc;">Reanalyses</h5>
		<label class="w3-block w3-padding-small">
		  <input type="radio" name="met_source" value="era5low_6h" checked>
		  ERA5 low resolution (6-hourly | 1.0Â° Ã— 1.0Â° | 137 levels | 1978â€“present)
		</label>
		<label class="w3-block w3-padding-small">
		  <input type="radio" name="met_source" value="erai_6h" required>
		  ERA-Interim (6-hourly | 0.75Â° Ã— 0.75Â° | 60 levels | 1979â€“2019)
		</label>
		<label class="w3-block w3-padding-small">
		  <input type="radio" name="met_source" value="jra3q_6h" required>
		  JRA-3Q (6-hourly | 0.375Â° Ã— 0.375Â° | 100 levels | 1948â€“present)
		</label>
		<label class="w3-block w3-padding-small">
		  <input type="radio" name="met_source" value="jra55_6h" required>
		  JRA-55 (6-hourly | 0.5625Â° Ã— 0.5625Â° | 60 levels | 1958â€“2023)
		</label>
		<label class="w3-block w3-padding-small">
		  <input type="radio" name="met_source" value="merra2_3h" required>
		  MERRA-2 (3-hourly | 0.5Â° Ã— 0.625Â° | 72 levels | 1980â€“present)
		</label>
		<label class="w3-block w3-padding-small">
		  <input type="radio" name="met_source" value="ncep_6h" required>
		  NCEP-NCAR Reanalysis 1 (6-hourly | 2.5Â° Ã— 2.5Â° | 17 levels | 1948â€“present)
		</label>
		<label class="w3-block w3-padding-small">
		  <input type="radio" name="met_source" value="ncep2_6h" required>
		  NCEP-DOE Reanalysis 2 (6-hourly | 2.5Â° Ã— 2.5Â° | 17 levels | 1979â€“present)
		</label>
              </div>
	    </div>
	  </div>
	</div>
      </div>
      
      <!-- Initialization Settings -->
      <button type="button" class="w3-button w3-block w3-dark-grey w3-left-align" style="margin-bottom: 12px;" onclick="toggleCollapsible('init-settings')">
	<i class="fa fa-caret-down"></i> Initialization Settings
      </button>
      <div id="init-settings" class="w3-container w3-hide" style="background-color: #1a1a1a; color: white; padding: 16px; margin-bottom: 12px;">
	
	<!-- Time Settings -->
	<p><strong>Simulation Time:</strong> Enter the simulation start and stop times in <code>YYYY-MM-DD HH:MM</code> (UTC). Simulations can run forward or backward in time but must not exceed 30 days.</p>
	<div class="w3-row-padding">
	  <div class="w3-half" style="padding: 16px;">
	    <label>Start Time</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="start_time" value="2000-01-01 00:00" required>
	  </div>
	  <div class="w3-half" style="padding: 16px;">
	    <label>Stop Time</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="stop_time" value="2000-01-05 00:00" required>
	  </div>
	</div>
	
	<hr style="border-color: #444;">
	
	<!-- Position Settings -->
	<p><strong>Initial Position:</strong> Specify the mean initial location of the air parcels. Heights are in kilometers above sea level and converted to pressure internally.</p>
	<div class="w3-row-padding">
	  <div class="w3-third" style="padding: 16px;">
	    <label>Mean Longitude [Â°]</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="mlon" value="0.0">
	  </div>
	  <div class="w3-third" style="padding: 16px;">
	    <label>Mean Latitude [Â°]</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="mlat" value="0.0">
	  </div>
	  <div class="w3-third" style="padding: 16px;">
	    <label>Mean Height [km]</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="mz" value="25.0">
	  </div>
	</div>
	
	<hr style="border-color: #444;">
	
	<!-- Perturbations -->
	<p><strong>Random Perturbations:</strong> Define uniform or Gaussian spreads (Full Width at Half Maximum, FWHM) to randomly perturb the initial positions of air parcels in longitude, latitude, and height.</p>
	<div class="w3-row-padding">
	  <div class="w3-third" style="padding: 16px;">
	    <label>Uniform Spread Longitude [Â°]</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="ulon" value="0.0">
	  </div>
	  <div class="w3-third" style="padding: 16px;">
	    <label>Uniform Spread Latitude [Â°]</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="ulat" value="0.0">
	  </div>
	  <div class="w3-third" style="padding: 16px;">
	    <label>Uniform Spread Height [km]</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="uz" value="50.0">
	  </div>
	</div>
	<div class="w3-row-padding">
	  <div class="w3-third" style="padding: 16px;">
	    <label>Gaussian Spread Longitude [Â°]</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="slon" value="0.0">
	  </div>
	  <div class="w3-third" style="padding: 16px;">
	    <label>Gaussian Spread Latitude [Â°]</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="slat" value="0.0">
	  </div>
	  <div class="w3-third" style="padding: 16px;">
	    <label>Gaussian Spread Height [km]</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="sz" value="0.0">
	  </div>
	</div>
	
	<hr style="border-color: #444;">
	
	<!-- Number of Parcels -->
	<p><strong>Number of Parcels:</strong> Specify the total number of air parcels to be released. The maximum allowed is 10,000.</p>
	<div class="w3-row-padding">
	  <div class="w3-third" style="padding: 16px;">
	    <label>Number of Air Parcels</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="rep" value="10000" required>
	  </div>
	</div>
      </div>
      
      <!-- Diffusivity Settings -->
      <button type="button" class="w3-button w3-block w3-dark-grey w3-left-align" style="margin-bottom: 12px;" onclick="toggleCollapsible('diffusivity-settings')">
	<i class="fa fa-caret-down"></i> Diffusivity Settings
      </button>
      <div id="diffusivity-settings" class="w3-container w3-hide" style="background-color: #1a1a1a; color: white; padding: 16px; margin-bottom: 12px;">
	<p>Define the stochastic perturbations of air parcel locations along trajectories by setting the horizontal and vertical diffusivity values for the PBL, troposphere, and stratosphere. Additionally, specify the subgrid-scale winds for both horizontal and vertical directions.</p>
	<div class="w3-row-padding">
	  <div class="w3-third" style="padding: 16px;">
            <label>Horizontal Diffusivity in PBL [mÂ²/s]</label>
            <input class="w3-input w3-dark-gray w3-round" type="text" name="turb_dx_pbl" value="50.0" required>
	  </div>
	  <div class="w3-third" style="padding: 16px;">
            <label>Horizontal Diffusivity in Troposphere [mÂ²/s]</label>
            <input class="w3-input w3-dark-gray w3-round" type="text" name="turb_dx_trop" value="50.0" required>
	  </div>
	  <div class="w3-third" style="padding: 16px;">
            <label>Horizontal Diffusivity in Stratosphere [mÂ²/s]</label>
            <input class="w3-input w3-dark-gray w3-round" type="text" name="turb_dx_strat" value="0.0" required>
	  </div>
	</div>
	<div class="w3-row-padding">
	  <div class="w3-third" style="padding: 16px;">
            <label>Vertical Diffusivity in PBL [mÂ²/s]</label>
            <input class="w3-input w3-dark-gray w3-round" type="text" name="turb_dz_pbl" value="0.0" required>
	  </div>
	  <div class="w3-third" style="padding: 16px;">
            <label>Vertical Diffusivity in Troposphere [mÂ²/s]</label>
            <input class="w3-input w3-dark-gray w3-round" type="text" name="turb_dz_trop" value="0.0" required>
	  </div>
	  <div class="w3-third" style="padding: 16px;">
            <label>Vertical Diffusivity in Stratosphere [mÂ²/s]</label>
            <input class="w3-input w3-dark-gray w3-round" type="text" name="turb_dz_strat" value="0.1" required>
	  </div>
	</div>
	<div class="w3-row-padding">
	  <div class="w3-third" style="padding: 16px;">
            <label>Horizontal Subgrid-Scale Winds</label>
            <input class="w3-input w3-dark-gray w3-round" type="text" name="turb_mesox" value="0.16" required>
	  </div>
	  <div class="w3-third" style="padding: 16px;">
            <label>Vertical Subgrid-Scale Winds</label>
            <input class="w3-input w3-dark-gray w3-round" type="text" name="turb_mesoz" value="0.16" required>
	  </div>
	</div>
	<hr style="border-color: #444;">
	<p>Select thresholds for extreme convection parametrization, and choose whether to enable vertical mixing throughout the planetary boundary layer (PBL).</p>
	<div class="w3-row-padding">
	  <div class="w3-third" style="padding: 16px;">
	    <label for="conv_cape">CAPE Threshold [J/kg]</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="conv_cape" id="conv_cape" value="-999" required>
	  </div>
	  <div class="w3-third" style="padding: 16px;">
	    <label for="conv_cin">CIN Threshold [J/kg]</label>
	    <input class="w3-input w3-dark-gray w3-round" type="text" name="conv_cin" id="conv_cin" value="-999" required>
	  </div>
	  <div class="w3-third" style="padding: 16px;">
	    <label>PBL Mixing</label><br>
	    <input class="w3-radio" type="radio" name="conv_mix_pbl" id="pbl_mix_yes" value="1">
	    <label for="pbl_mix_yes" style="margin-right: 16px;">Yes</label>
	    <input class="w3-radio" type="radio" name="conv_mix_pbl" id="pbl_mix_no" value="0" checked>
	    <label for="pbl_mix_no">No</label>
	  </div>
	</div>
      </div>
      
      <!-- Output Settings -->
      <button type="button" class="w3-button w3-block w3-dark-grey w3-left-align" style="margin-bottom: 12px;" onclick="toggleCollapsible('output-settings')">
	<i class="fa fa-caret-down"></i> Output Settings
      </button>
      <div id="output-settings" class="w3-container w3-hide" style="background-color: #1a1a1a; color: white; padding: 16px; margin-bottom: 12px;">
	<p>Select the output interval to determine how frequently simulation results are recorded.</p>
	<div class="w3-row-padding">
	  <div class="w3-full" style="padding: 16px;">
	    <label>Output Interval</label><br>
	    <label style="margin-right: 16px;"><input class="w3-radio" type="radio" name="atm_dt_out" value="900"> 15 min</label>
	    <label style="margin-right: 16px;"><input class="w3-radio" type="radio" name="atm_dt_out" value="1800"> 30 min</label>
	    <label style="margin-right: 16px;"><input class="w3-radio" type="radio" name="atm_dt_out" value="3600"> 1 h</label>
	    <label style="margin-right: 16px;"><input class="w3-radio" type="radio" name="atm_dt_out" value="10800"> 3 h</label>
	    <label style="margin-right: 16px;"><input class="w3-radio" type="radio" name="atm_dt_out" value="21600" checked> 6 h</label>
	    <label style="margin-right: 16px;"><input class="w3-radio" type="radio" name="atm_dt_out" value="43200"> 12 h</label>
	    <label style="margin-right: 16px;"><input class="w3-radio" type="radio" name="atm_dt_out" value="86400"> 24 h</label>
	  </div>
	</div>
	<hr style="border-color: #444;">
	<p>Select parameters for quick look plot.</p>
	<div class="w3-row-padding">
	  <div class="w3-third" style="padding: 16px;">
	    <label>Plot Region</label><br>
	    <label><input class="w3-radio" type="radio" name="plot_region" value="global" checked> Global</label><br>
	    <label><input class="w3-radio" type="radio" name="plot_region" value="regional"> Regional</label>
	  </div>
	  <div class="w3-third" style="padding: 16px;">
	    <label>Map Projection</label><br>
	    <label><input class="w3-radio" type="radio" name="map_projection" value="cartesian" checked> Cartesian</label><br>
	    <label><input class="w3-radio" type="radio" name="map_projection" value="orthographic"> Orthographic</label><br>
	    <label><input class="w3-radio" type="radio" name="map_projection" value="robinson"> Robinson</label>
	  </div>
	  <div class="w3-third" style="padding: 16px;">
	    <div>
	      <label>Central Longitude [Â°]</label>
	      <input class="w3-input w3-dark-gray w3-round" type="text" name="central_lon" value="0.0" required>
	    </div>
	    <br>
	    <div>
	      <label>Central Latitude [Â°]</label>
	      <input class="w3-input w3-dark-gray w3-round" type="text" name="central_lat" value="0.0" required>
	    </div>
	  </div>
	</div>
      </div>
      
      <br>
      
      <!-- Buttons -->
      <div class="w3-bar w3-center" style="margin-top: 20px;">
	<button class="w3-button w3-hover-shadow w3-padding-large w3-round-xxlarge w3-hover-light-blue" style="background: #003366; color: white; font-size: 18px; border: none; transition: background-color 0.3s ease; margin-right: 20px;" type="submit">
	  â–¶ï¸ Run Simulation
	</button>
	
	<button type="reset" class="w3-button w3-hover-shadow w3-padding-large w3-round-xxlarge w3-hover-light-blue" style="background: #003366; color: white; font-size: 18px; border: none; transition: background-color 0.3s ease;">
	  â™»ï¸ Reset Form
	</button>
      </div>
    </form>
    
    <!-- JavaScript for Collapsible Sections -->
    <script>
      function toggleCollapsible(sectionId) {
	  var section = document.getElementById(sectionId);
	  if (section.classList.contains("w3-hide")) {
	      section.classList.remove("w3-hide");
	  } else {
	      section.classList.add("w3-hide");
	  }
      }
    </script>
    
    <!-- Modal for showing progress -->
    <div id="progressModal" class="w3-modal" style="display:none;">
      <div class="w3-modal-content w3-center w3-round-large w3-padding-32" style="background:#222;">
	<h2 class="w3-text-white">Running Simulation...</h2>
	<div class="w3-center w3-padding-16">
	  <i class="w3-spin w3-jumbo w3-text-light-blue fa fa-cog"></i>
	</div>
	<p class="w3-text-light-grey" style="width: 80%; margin: 0 auto; margin-top: 12px;">
	  Please wait while we process your request. Processing may take several minutes. Maximum runtime is limited to 10 minutes.
	</p>
	<button onclick="location.reload()" class="w3-button w3-hover-shadow w3-padding-large w3-round-xxlarge w3-hover-light-blue" style="background: #003366; color: white; font-size: 18px; border: none; transition: background-color 0.3s ease; margin-top: 24px;">
	  â¹ï¸ Stop Simulation
	</button>
      </div>
    </div>
    <script>
      function showProgressModal() {
	  document.getElementById('progressModal').style.display = 'block';
      }
    </script>
    
    <!-- Footer -->
    <footer class="w3-container w3-center w3-padding-32" style="background-color:#001f4d; color:white; margin-top:40px;">
      <p style="margin: 0;">
	<a href="/terms" class="w3-button w3-small w3-hover-light-blue w3-round-large" style="background: #003366; color: white;">Terms & Conditions</a>
	| <a href="https://www.fz-juelich.de/en/legal-notice" class="w3-button w3-small w3-hover-light-blue w3-round-large" style="background: #003366; color: white;">Legal Notice</a>
	| <a href="https://www.fz-juelich.de/en/privacy-policy" class="w3-button w3-small w3-hover-light-blue w3-round-large" style="background: #003366; color: white;">Privacy Policy</a>
	| <a href="https://www.fz-juelich.de" class="w3-button w3-small w3-hover-light-blue w3-round-large" style="background-color: white; color: #003366; ; padding: 2px 10px;">
	  <img src="/static/images/fzj_logo.png" alt="FZJ Logo" style="height: 26px; padding: 0pt;">
	</a>
      </p>
    </footer>
    
  </body>
</html>
